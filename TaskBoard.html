<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskBoard ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #111827;
        }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        .modal-enter {
            animation: modalEnter 0.3s ease-out;
        }
        @keyframes modalEnter {
            from { opacity: 0; transform: scale(0.95) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .btn-edit {
            opacity: 0;
            transition: opacity 0.2s;
        }
        .card-container:hover .btn-edit {
            opacity: 1;
        }

        /* Dark Theme Styles */
        .bg-white { background-color: #1f2937 !important; }
        .bg-gray-100 { background-color: #111827 !important; }
        .bg-gray-50 { background-color: #1a2234 !important; }
        .bg-gray-200 { background-color: #374151 !important; }
        .bg-gray-800 { background-color: #0f172a !important; }
        .text-gray-800, .text-gray-700 { color: #f3f4f6 !important; }
        .text-gray-600 { color: #d1d5db !important; }
        .text-gray-500 { color: #9ca3af !important; }
        .text-gray-400 { color: #9ca3af !important; }
        .border-gray-100 { border-color: #374151 !important; }
        .border-gray-300 { border-color: #4b5563 !important; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important; }
        .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important; }
        
        input, textarea, select {
            background-color: #374151 !important;
            color: #f3f4f6 !important;
            border-color: #4b5563 !important;
        }
        
        input::placeholder, textarea::placeholder {
            color: #9ca3af !important;
        }
        
        .hover\:bg-purple-50:hover { background-color: rgba(139, 92, 246, 0.1) !important; }
        .modal-enter { background-color: #1f2937; }
        
        #employeeCheckboxes { background-color: #1f2937 !important; }
        #employeeCheckboxes label:hover { background-color: #374151 !important; }
        #employeeCheckboxes span.text-gray-800 { color: #f3f4f6 !important; }
        
        .from-purple-50 { --tw-gradient-from: rgba(88, 28, 135, 0.3) !important; }
        .to-indigo-50 { --tw-gradient-to: rgba(49, 46, 129, 0.3) !important; }
        .border-purple-300 { border-color: #7c3aed !important; }
        .ring-purple-100 { --tw-ring-color: rgba(124, 58, 237, 0.3) !important; }
        .text-purple-800 { color: #c4b5fd !important; }
        .text-indigo-600 { color: #a5b4fc !important; }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-8 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl font-bold text-center mb-2">üìä TaskBoard</h1>
            <p class="text-center text-purple-100 text-lg">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏, –∑–∞–¥–∞—á–∞–º–∏ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</p>
        </div>
    </header>

    <!-- Stats Bar -->
    <div class="bg-white shadow-md py-4">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center gap-8">
                <div class="text-center">
                    <span class="text-3xl font-bold text-purple-600" id="totalDirections">0</span>
                    <p class="text-gray-500 text-sm">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π</p>
                </div>
                <div class="text-center">
                    <span class="text-3xl font-bold text-green-600" id="totalTasks">0</span>
                    <p class="text-gray-500 text-sm">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</p>
                </div>
                <div class="text-center">
                    <span class="text-3xl font-bold text-blue-600" id="teamMembers">0</span>
                    <p class="text-gray-500 text-sm">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
                </div>
                <div class="text-center">
                    <span class="text-3xl font-bold text-orange-600" id="efficiency">0%</span>
                    <p class="text-gray-500 text-sm">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Matrix Grid -->
    <main class="container mx-auto px-4 py-10">
        <!-- Priority Axis Labels -->
        <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
            <div class="flex items-center gap-2">
                <span class="text-sm font-medium text-gray-500">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</span>
                <span class="px-3 py-1 bg-red-500/40 text-red-200 border border-black rounded-full text-xs font-medium">üî¥ –í—ã—Å–æ–∫–∏–π</span>
                <span class="px-3 py-1 bg-yellow-500/40 text-yellow-200 border border-black rounded-full text-xs font-medium">üü° –°—Ä–µ–¥–Ω–∏–π</span>
                <span class="px-3 py-1 bg-green-500/40 text-green-200 border border-black rounded-full text-xs font-medium">üü¢ –ë–∞–∑–æ–≤—ã–π</span>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <span class="text-sm font-medium text-gray-500">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="w-3 h-3 bg-green-500 rounded-full pulse"></span>
                    <span class="text-xs text-gray-600">–ê–∫—Ç–∏–≤–Ω–æ</span>
                </div>
                <button onclick="openAddModal()" class="bg-gradient-to-r from-purple-500 to-indigo-500 text-white px-4 py-2 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all hover:scale-105 flex items-center gap-2">
                    <span class="text-xl">+</span> –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                </button>
            </div>
        </div>

        <!-- Matrix Table -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="matrixGrid">
            <!-- Cards will be inserted by JavaScript -->
        </div>

        <!-- Employees Section -->
        <div class="mt-12 bg-white rounded-2xl shadow-lg p-6">
            <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-800">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
                <div class="flex gap-3">
                    <input type="text" id="employeeSearch" placeholder="üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞..." 
                           class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                           oninput="filterEmployees()">
                    <button onclick="openEmployeeModal()" class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-4 py-2 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all hover:scale-105 flex items-center gap-2">
                        <span class="text-xl">+</span> –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="employeesGrid">
                <!-- Employee cards will be inserted by JavaScript -->
            </div>
            <div id="noEmployees" class="hidden text-center py-10 text-gray-500">
                <div class="text-5xl mb-3">üë§</div>
                <p>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            </div>
        </div>
    </main>

    <!-- Save Buttons -->
    <div class="fixed bottom-6 left-6 z-40 flex flex-col gap-2">
        <button onclick="exportJSON()" class="flex items-center gap-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-5 py-3 rounded-xl font-medium shadow-2xl hover:shadow-lg transition-all hover:scale-105" title="–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö">
            <span class="text-xl">üì§</span> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (JSON)
        </button>
        <button onclick="document.getElementById('importFile').click()" class="flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-5 py-3 rounded-xl font-medium shadow-2xl hover:shadow-lg transition-all hover:scale-105" title="–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö">
            <span class="text-xl">üì•</span> –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (JSON)
        </button>
        <input type="file" id="importFile" accept=".json" class="hidden" onchange="importJSON(this)">
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-10">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-center items-center gap-4 text-center">
                <p class="text-gray-400">üìÖ –°–æ–∑–¥–∞–Ω–æ: <span id="updateDate"></span></p>
                <span class="hidden md:inline text-gray-600">|</span>
                <p class="text-gray-400 flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full pulse"></span>
                    üíæ –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: <span id="lastSaveTime" class="text-green-400 font-medium">‚Äî</span>
                </p>
            </div>
        </div>
    </footer>

    <!-- Modal for Add/Edit Direction -->
    <div id="directionModal" class="fixed inset-0 modal-overlay z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto modal-enter">
            <div class="bg-gradient-to-r from-purple-500 to-indigo-500 p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h3 id="modalTitle" class="text-2xl font-bold text-white">–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                    <button onclick="closeModal()" class="text-white/80 hover:text-white text-3xl">&times;</button>
                </div>
            </div>
            <form id="directionForm" class="p-6 space-y-4">
                <input type="hidden" id="editId" value="">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)</label>
                    <input type="text" id="formIcon" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="üéØ" maxlength="4">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</label>
                    <input type="text" id="formTitle" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                    <select id="formPriority" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="high">üî¥ –í—ã—Å–æ–∫–∏–π</option>
                        <option value="medium">üü° –°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="base">üü¢ –ë–∞–∑–æ–≤—ã–π</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞</label>
                    <select id="formColor" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="from-red-500 to-pink-500">–ö—Ä–∞—Å–Ω–æ-—Ä–æ–∑–æ–≤—ã–π</option>
                        <option value="from-blue-500 to-cyan-500">–°–∏–Ω–µ-–≥–æ–ª—É–±–æ–π</option>
                        <option value="from-green-500 to-teal-500">–ó–µ–ª–µ–Ω–æ-–±–∏—Ä—é–∑–æ–≤—ã–π</option>
                        <option value="from-purple-500 to-indigo-500">–§–∏–æ–ª–µ—Ç–æ–≤–æ-–∏–Ω–¥–∏–≥–æ</option>
                        <option value="from-orange-500 to-amber-500">–û—Ä–∞–Ω–∂–µ–≤–æ-—è–Ω—Ç–∞—Ä–Ω—ã–π</option>
                        <option value="from-yellow-500 to-orange-500">–ñ–µ–ª—Ç–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π</option>
                        <option value="from-violet-500 to-purple-500">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
                        <option value="from-rose-500 to-red-500">–†–æ–∑–æ–≤–æ-–∫—Ä–∞—Å–Ω—ã–π</option>
                        <option value="from-gray-500 to-slate-500">–°–µ—Ä—ã–π</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">üìã –ó–∞–¥–∞—á–∏ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</label>
                    <div class="border border-gray-300 rounded-lg p-3 max-h-96 overflow-y-auto bg-gray-50" id="tasksContainer">
                        <!-- Tasks with employee selectors will be populated by JavaScript -->
                    </div>
                    <button type="button" onclick="addTaskRow()" class="mt-2 text-sm text-purple-600 hover:text-purple-800 flex items-center gap-1">
                        <span>+</span> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
                    </button>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–ü—Ä–æ–≥—Ä–µ—Å—Å (%)</label>
                        <input type="number" id="formProgress" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" min="0" max="100" value="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–ö–æ–º–∞–Ω–¥–∞ (—á–µ–ª.)</label>
                        <input type="number" id="formTeam" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" min="1" value="0" readonly>
                    </div>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-3 rounded-lg font-medium hover:shadow-lg transition-all">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button type="button" onclick="closeModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-all">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Employee Modal -->
    <div id="employeeModal" class="fixed inset-0 modal-overlay z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto modal-enter">
            <div class="bg-gradient-to-r from-blue-500 to-cyan-500 p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h3 id="employeeModalTitle" class="text-2xl font-bold text-white">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
                    <button onclick="closeEmployeeModal()" class="text-white/80 hover:text-white text-3xl">&times;</button>
                </div>
            </div>
            <form id="employeeForm" class="p-6 space-y-4">
                <input type="hidden" id="employeeEditId" value="">
                
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" id="employeeLastName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="–ò–≤–∞–Ω–æ–≤" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–ò–º—è</label>
                        <input type="text" id="employeeFirstName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="–ò–≤–∞–Ω" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                        <input type="text" id="employeeMiddleName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="–ò–≤–∞–Ω–æ–≤–∏—á">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                    <input type="text" id="employeePosition" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">–†–æ–ª—å</label>
                    <select id="employeeRole" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å">üëî –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</option>
                        <option value="–ê–Ω–∞–ª–∏—Ç–∏–∫">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫</option>
                        <option value="–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫">üíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</option>
                        <option value="–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫</option>
                        <option value="–ú–µ–Ω–µ–¥–∂–µ—Ä">üìã –ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                        <option value="–î–∏–∑–∞–π–Ω–µ—Ä">üé® –î–∏–∑–∞–π–Ω–µ—Ä</option>
                        <option value="DevOps">‚öôÔ∏è DevOps</option>
                        <option value="–î—Ä—É–≥–æ–µ">üìå –î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="employeeEmail" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="email@example.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="employeePhone" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="+7 (999) 123-45-67">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–°—Ç–∞—Ç—É—Å</label>
                        <select id="employeeStatus" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="toggleSubstituteField()">
                            <option value="active">üü¢ –ê–∫—Ç–∏–≤–µ–Ω</option>
                            <option value="vacation">üèñÔ∏è –í –æ—Ç–ø—É—Å–∫–µ</option>
                            <option value="sick">üè• –ù–∞ –±–æ–ª—å–Ω–∏—á–Ω–æ–º</option>
                            <option value="remote">üè† –£–¥–∞–ª—ë–Ω–Ω–æ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–î–∞—Ç–∞ –ø—Ä–∏—ë–º–∞</label>
                        <input type="date" id="employeeHireDate" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <!-- –ü–æ–ª–µ –≤—ã–±–æ—Ä–∞ –∑–∞–º–µ—â–∞—é—â–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
                <div id="substituteField" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">üîÑ –ó–∞–º–µ—â–∞—é—â–∏–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
                    <select id="employeeSubstitute" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>
                        <!-- Will be populated by JavaScript -->
                    </select>
                    <p class="text-xs text-gray-500 mt-1">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–º–µ—â–∞—Ç—å –Ω–∞ –≤—Ä–µ–º—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è</p>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-3 rounded-lg font-medium hover:shadow-lg transition-all">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button type="button" onclick="closeEmployeeModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-all">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Employee Modal -->
    <div id="deleteEmployeeModal" class="fixed inset-0 modal-overlay z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full modal-enter">
            <div class="p-6 text-center">
                <div class="text-6xl mb-4">üë§</div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?</h3>
                <p class="text-gray-600 mb-6">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –∏–∑ –±–∞–∑—ã.</p>
                <div class="flex gap-3">
                    <button onclick="confirmDeleteEmployee()" class="flex-1 bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-all">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                    <button onclick="closeDeleteEmployeeModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-all">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 modal-overlay z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full modal-enter">
            <div class="p-6 text-center">
                <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">–£–¥–∞–ª–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ?</h3>
                <p class="text-gray-600 mb-6">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞.</p>
                <div class="flex gap-3">
                    <button onclick="confirmDelete()" class="flex-1 bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-all">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                    <button onclick="closeDeleteModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-all">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        <span id="toastMessage">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!</span>
    </div>

    <script>

        
        // Data arrays ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        let directions = [
            {
                id: 1,
                title: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
                icon: "üíª",
                priority: "high",
                status: "active",
                tasks: [
                    { name: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π", assignedEmployees: [] },
                    { name: "–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞", assignedEmployees: [] },
                    { name: "Code Review", assignedEmployees: [] }
                ],
                progress: 75,
                color: "from-blue-500 to-cyan-500"
            },
            {
                id: 2,
                title: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
                icon: "üìä",
                priority: "high",
                status: "active",
                tasks: [
                    { name: "–°–±–æ—Ä —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π", assignedEmployees: [] },
                    { name: "–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö", assignedEmployees: [] },
                    { name: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ç—á—ë—Ç–æ–≤", assignedEmployees: [] }
                ],
                progress: 60,
                color: "from-purple-500 to-indigo-500"
            },
            {
                id: 3,
                title: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
                icon: "üß™",
                priority: "medium",
                status: "active",
                tasks: [
                    { name: "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ", assignedEmployees: [] },
                    { name: "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤", assignedEmployees: [] },
                    { name: "–†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ", assignedEmployees: [] }
                ],
                progress: 80,
                color: "from-green-500 to-teal-500"
            },
            {
                id: 4,
                title: "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
                icon: "üìù",
                priority: "medium",
                status: "active",
                tasks: [
                    { name: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è", assignedEmployees: [] },
                    { name: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏", assignedEmployees: [] }
                ],
                progress: 45,
                color: "from-gray-500 to-slate-500"
            },
            {
                id: 5,
                title: "–ü–æ–¥–¥–µ—Ä–∂–∫–∞",
                icon: "üõ†Ô∏è",
                priority: "base",
                status: "active",
                tasks: [
                    { name: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π", assignedEmployees: [] },
                    { name: "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π", assignedEmployees: [] }
                ],
                progress: 90,
                color: "from-orange-500 to-amber-500"
            }
        ];

        // Employees data ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        let employees = [
            { id: 1, firstName: "–ò–≤–∞–Ω", middleName: "–ò–≤–∞–Ω–æ–≤–∏—á", lastName: "–ò–≤–∞–Ω–æ–≤", position: "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞", role: "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å", email: "ivanov@example.com", phone: "+7 (999) 111-11-11", direction: "", status: "active", hireDate: "2020-01-15", substituteId: null },
            { id: 2, firstName: "–ü—ë—Ç—Ä", middleName: "–ü–µ—Ç—Ä–æ–≤–∏—á", lastName: "–ü–µ—Ç—Ä–æ–≤", position: "–í–µ–¥—É—â–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", role: "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", email: "petrov@example.com", phone: "+7 (999) 222-22-22", direction: "", status: "active", hireDate: "2021-03-20", substituteId: null },
            { id: 3, firstName: "–°–µ—Ä–≥–µ–π", middleName: "–°–µ—Ä–≥–µ–µ–≤–∏—á", lastName: "–°–µ—Ä–≥–µ–µ–≤", position: "–ê–Ω–∞–ª–∏—Ç–∏–∫", role: "–ê–Ω–∞–ª–∏—Ç–∏–∫", email: "sergeev@example.com", phone: "+7 (999) 333-33-33", direction: "", status: "active", hireDate: "2022-06-10", substituteId: null },
            { id: 4, firstName: "–ê–Ω–Ω–∞", middleName: "–ê–Ω–¥—Ä–µ–µ–≤–Ω–∞", lastName: "–ê–Ω–¥—Ä–µ–µ–≤–∞", position: "–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫", role: "–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫", email: "andreeva@example.com", phone: "+7 (999) 444-44-44", direction: "", status: "active", hireDate: "2021-09-05", substituteId: null }
        ];

        let deleteEmployeeTargetId = null;

        // Save functions
        function saveDirections() {
            localStorage.setItem('taskboard_directions', JSON.stringify(directions));
            updateStats();
            updateLastSaveTime();
        }

        function saveEmployees() {
            localStorage.setItem('taskboard_employees', JSON.stringify(employees));
            updateStats();
            updateLastSaveTime();
        }

        // Update last save time
        function updateLastSaveTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            localStorage.setItem('taskboard_lastSaveTime', timeString);
            localStorage.setItem('taskboard_dataTimestamp', Date.now().toString());
            document.getElementById('lastSaveTime').textContent = timeString;
        }

        function loadLastSaveTime() {
            const savedTime = localStorage.getItem('taskboard_lastSaveTime');
            if (savedTime) {
                document.getElementById('lastSaveTime').textContent = savedTime;
            } else {
                document.getElementById('lastSaveTime').textContent = '–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π';
            }
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalDirections').textContent = directions.length;
            document.getElementById('teamMembers').textContent = employees.length;
            
            // –ü–æ–¥—Å—á—ë—Ç –∑–∞–¥–∞—á
            var totalTasks = 0;
            for (var i = 0; i < directions.length; i++) {
                if (directions[i].tasks) {
                    totalTasks += directions[i].tasks.length;
                }
            }
            document.getElementById('totalTasks').textContent = totalTasks;
            
            // –ü–æ–¥—Å—á—ë—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: (—Å—É–º–º–∞ —á–∞—Å–æ–≤ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤) / (–∫–æ–ª-–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ * 40) * 100%
            var totalAssignedHours = 0;
            for (var i = 0; i < directions.length; i++) {
                var dir = directions[i];
                if (!dir.tasks) continue;
                for (var j = 0; j < dir.tasks.length; j++) {
                    var task = dir.tasks[j];
                    if (!task.assignedEmployees) continue;
                    for (var k = 0; k < task.assignedEmployees.length; k++) {
                        var ae = task.assignedEmployees[k];
                        if (typeof ae === 'object' && ae !== null) {
                            totalAssignedHours += (ae.hours || 0);
                        }
                    }
                }
            }
            
            var maxHours = employees.length * 40;
            var efficiency = 0;
            if (maxHours > 0) {
                efficiency = Math.round((totalAssignedHours / maxHours) * 100);
            }
            document.getElementById('efficiency').textContent = efficiency + '%';
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toast.className = `fixed bottom-6 right-6 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-0 opacity-100 transition-all duration-300 z-50`;
            toastMessage.textContent = message;
            setTimeout(() => {
                toast.className = `fixed bottom-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50`;
            }, 3000);
        }

        // Modal functions
        let deleteTargetId = null;
        let currentTasks = [];

        // Task management functions
        function renderTasksContainer(tasks = []) {
            const container = document.getElementById('tasksContainer');
            currentTasks = tasks.length > 0 ? tasks.map(task => {
                if (task.assignedEmployees && task.assignedEmployees.length > 0 && typeof task.assignedEmployees[0] === 'number') {
                    return {
                        name: task.name,
                        assignedEmployees: task.assignedEmployees.map(id => ({ id: id, hours: 8 }))
                    };
                }
                return task;
            }) : [{ name: '', assignedEmployees: [] }];
            
            container.innerHTML = currentTasks.map((task, index) => {
                const assignedEmps = task.assignedEmployees || [];
                return `
                <div class="task-row mb-3 p-3 bg-white rounded-lg border border-gray-200" data-index="${index}">
                    <div class="flex items-center gap-2 mb-2">
                        <input type="text" class="task-name flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent" 
                               placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" value="${task.name || ''}" onchange="updateTaskName(${index}, this.value)">
                        <button type="button" onclick="removeTaskRow(${index})" class="w-8 h-8 bg-red-100 hover:bg-red-200 rounded flex items-center justify-center text-sm" title="–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É">üóëÔ∏è</button>
                    </div>
                    <div class="mt-2">
                        <label class="text-xs text-gray-500 mb-1 block">üë§ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label>
                        <select class="add-employee-select w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent" 
                                onchange="addEmployeeToTask(${index}, this)">
                            <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ‚Äî</option>
                            ${employees.filter(emp => !assignedEmps.some(ae => ae.id === emp.id)).map(emp => `
                                <option value="${emp.id}">
                                    ${emp.lastName} ${emp.firstName} ${emp.middleName || ''} (${emp.position})
                                </option>
                            `).join('')}
                        </select>
                    </div>
                    <div class="mt-2 space-y-2" id="taskEmployees_${index}">
                        ${assignedEmps.map((ae) => {
                            const emp = getEmployeeById(ae.id);
                            if (!emp) return '';
                            const isLead = ae.isLead === true;
                            return `
                            <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-2">
                                <button type="button" onclick="toggleLeadEmployee(${index}, ${ae.id})" 
                                        class="w-6 h-6 ${isLead ? 'bg-yellow-400 text-white' : 'bg-gray-200 text-gray-400 hover:bg-yellow-200'} rounded flex items-center justify-center text-xs transition-all" 
                                        title="${isLead ? '–°–Ω—è—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ' : '–ù–∞–∑–Ω–∞—á–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º'}">‚≠ê</button>
                                <span class="flex-1 text-sm ${isLead ? 'font-bold text-gray-800' : 'text-gray-700'}">${emp.lastName} ${emp.firstName} ${emp.middleName || ''}</span>
                                <div class="flex items-center gap-1">
                                    <input type="number" min="1" value="${ae.hours || 8}" 
                                           class="w-16 border border-gray-300 rounded px-2 py-1 text-sm text-center focus:ring-2 focus:ring-purple-500"
                                           onchange="updateEmployeeHours(${index}, ${ae.id}, this.value)" title="–ß–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é">
                                    <span class="text-xs text-gray-500">—á/–Ω–µ–¥</span>
                                </div>
                                <button type="button" onclick="removeEmployeeFromTask(${index}, ${ae.id})" 
                                        class="w-6 h-6 bg-red-100 hover:bg-red-200 rounded flex items-center justify-center text-xs" title="–£–±—Ä–∞—Ç—å">‚úï</button>
                            </div>
                            `;
                        }).join('')}
                        ${assignedEmps.length === 0 ? '<p class="text-xs text-gray-400 italic">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã</p>' : ''}
                    </div>
                </div>
            `}).join('');
            
            updateTeamCount();
        }

        function addEmployeeToTask(taskIndex, selectElement) {
            const empId = parseInt(selectElement.value);
            if (!empId) return;
            
            if (!currentTasks[taskIndex].assignedEmployees) {
                currentTasks[taskIndex].assignedEmployees = [];
            }
            currentTasks[taskIndex].assignedEmployees.push({ id: empId, hours: 8 });
            renderTasksContainer(currentTasks);
        }

        function removeEmployeeFromTask(taskIndex, empId) {
            currentTasks[taskIndex].assignedEmployees = currentTasks[taskIndex].assignedEmployees.filter(ae => ae.id !== empId);
            renderTasksContainer(currentTasks);
        }

        function updateEmployeeHours(taskIndex, empId, hours) {
            const emp = currentTasks[taskIndex].assignedEmployees.find(ae => ae.id === empId);
            if (emp) {
                emp.hours = parseInt(hours) || 8;
            }
        }

        function toggleLeadEmployee(taskIndex, empId) {
            const assignedEmps = currentTasks[taskIndex].assignedEmployees;
            assignedEmps.forEach(ae => {
                if (ae.id === empId) {
                    ae.isLead = !ae.isLead;
                } else {
                    ae.isLead = false;
                }
            });
            renderTasksContainer(currentTasks);
        }

        function addTaskRow() {
            currentTasks.push({ name: '', assignedEmployees: [] });
            renderTasksContainer(currentTasks);
        }

        function removeTaskRow(index) {
            if (currentTasks.length > 1) {
                currentTasks.splice(index, 1);
                renderTasksContainer(currentTasks);
            } else {
                showToast('–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞', 'error');
            }
        }

        function updateTaskName(index, value) {
            currentTasks[index].name = value;
        }

        function updateTeamCount() {
            const allEmployeeIds = new Set();
            currentTasks.forEach(task => {
                if (task.assignedEmployees) {
                    task.assignedEmployees.forEach(ae => {
                        const id = typeof ae === 'object' ? ae.id : ae;
                        allEmployeeIds.add(id);
                    });
                }
            });
            document.getElementById('formTeam').value = allEmployeeIds.size;
        }

        function getTasksFromForm() {
            return currentTasks.filter(task => task.name && task.name.trim() !== '').map(task => ({
                name: task.name.trim(),
                assignedEmployees: (task.assignedEmployees || []).map(ae => ({
                    id: typeof ae === 'object' ? ae.id : ae,
                    hours: typeof ae === 'object' ? ae.hours : 8,
                    isLead: typeof ae === 'object' ? (ae.isLead || false) : false
                }))
            }));
        }

        function openAddModal() {
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ';
            document.getElementById('editId').value = '';
            document.getElementById('formIcon').value = 'üéØ';
            document.getElementById('formTitle').value = '';
            document.getElementById('formPriority').value = 'medium';
            document.getElementById('formColor').value = 'from-purple-500 to-indigo-500';
            document.getElementById('formProgress').value = 0;
            document.getElementById('formTeam').value = 0;
            renderTasksContainer([{ name: '', assignedEmployees: [] }]);
            document.getElementById('directionModal').classList.remove('hidden');
            document.getElementById('directionModal').classList.add('flex');
        }

        function openEditModal(id) {
            event.stopPropagation();
            const dir = directions.find(d => d.id === id);
            if (!dir) return;
            
            document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ';
            document.getElementById('editId').value = id;
            document.getElementById('formIcon').value = dir.icon;
            document.getElementById('formTitle').value = dir.title;
            document.getElementById('formPriority').value = dir.priority;
            document.getElementById('formColor').value = dir.color;
            document.getElementById('formProgress').value = dir.progress;
            
            let tasks = dir.tasks || [];
            if (tasks.length > 0 && typeof tasks[0] === 'string') {
                tasks = tasks.map(t => ({ name: t, assignedEmployees: [] }));
            }
            renderTasksContainer(tasks);
            
            document.getElementById('directionModal').classList.remove('hidden');
            document.getElementById('directionModal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('directionModal').classList.add('hidden');
            document.getElementById('directionModal').classList.remove('flex');
        }

        function openDeleteModal(id) {
            event.stopPropagation();
            deleteTargetId = id;
            document.getElementById('deleteModal').classList.remove('hidden');
            document.getElementById('deleteModal').classList.add('flex');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            document.getElementById('deleteModal').classList.remove('flex');
            deleteTargetId = null;
        }

        function confirmDelete() {
            if (deleteTargetId) {
                directions = directions.filter(d => d.id !== deleteTargetId);
                saveDirections();
                renderCards();
                renderEmployees();
                closeDeleteModal();
                showToast('–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
            }
        }

        // Form submission
        document.getElementById('directionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editId = document.getElementById('editId').value;
            const tasks = getTasksFromForm();
            
            if (tasks.length === 0) {
                showToast('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∑–∞–¥–∞—á—É', 'error');
                return;
            }
            
            const dirData = {
                icon: document.getElementById('formIcon').value || 'üìå',
                title: document.getElementById('formTitle').value,
                priority: document.getElementById('formPriority').value,
                color: document.getElementById('formColor').value,
                tasks: tasks,
                progress: parseInt(document.getElementById('formProgress').value) || 0,
                status: 'active'
            };
            
            if (editId) {
                const index = directions.findIndex(d => d.id === parseInt(editId));
                if (index !== -1) {
                    directions[index] = { ...directions[index], ...dirData };
                }
                showToast('–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
            } else {
                const newId = directions.length > 0 ? Math.max(...directions.map(d => d.id)) + 1 : 1;
                directions.push({ id: newId, ...dirData });
                showToast('–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
            }
            
            saveDirections();
            renderCards();
            renderEmployees();
            closeModal();
        });

        // Helper functions
        function getEmployeeById(id) {
            return employees.find(emp => emp.id === id);
        }

        function getUniqueEmployeesCount(dir) {
            const allIds = new Set();
            if (dir.tasks && Array.isArray(dir.tasks)) {
                dir.tasks.forEach(task => {
                    if (typeof task === 'object' && task.assignedEmployees) {
                        task.assignedEmployees.forEach(ae => {
                            const id = typeof ae === 'object' ? ae.id : ae;
                            allIds.add(id);
                        });
                    }
                });
            }
            return allIds.size;
        }

        function calculateEmployeeWorkload(empId) {
            let totalHours = 0;
            let tasksList = [];
            
            for (let i = 0; i < directions.length; i++) {
                const dir = directions[i];
                if (!dir.tasks || !Array.isArray(dir.tasks)) continue;
                
                for (let j = 0; j < dir.tasks.length; j++) {
                    const task = dir.tasks[j];
                    if (!task.assignedEmployees || !Array.isArray(task.assignedEmployees)) continue;
                    
                    for (let k = 0; k < task.assignedEmployees.length; k++) {
                        const ae = task.assignedEmployees[k];
                        let id, hours;
                        if (typeof ae === 'object' && ae !== null) {
                            id = ae.id;
                            hours = ae.hours || 0;
                        } else {
                            id = ae;
                            hours = 0;
                        }
                        
                        if (id === empId) {
                            totalHours += hours;
                            tasksList.push({
                                direction: dir.title,
                                task: task.name,
                                hours: hours
                            });
                        }
                    }
                }
            }
            
            return { totalHours: totalHours, tasksList: tasksList };
        }

        function getWorkloadColor(hours) {
            if (hours >= 40) return 'bg-red-500';
            if (hours >= 30) return 'bg-orange-500';
            if (hours >= 20) return 'bg-yellow-500';
            if (hours > 0) return 'bg-green-500';
            return 'bg-gray-300';
        }

        function getWorkloadLabel(hours) {
            if (hours >= 40) return '–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞';
            if (hours >= 30) return '–í—ã—Å–æ–∫–∞—è';
            if (hours >= 20) return '–°—Ä–µ–¥–Ω—è—è';
            if (hours > 0) return '–ù–∏–∑–∫–∞—è';
            return '–°–≤–æ–±–æ–¥–µ–Ω';
        }

        // Render direction cards
        function renderCards() {
            const grid = document.getElementById('matrixGrid');
            grid.innerHTML = directions.map(dir => {
                const uniqueEmployeesCount = getUniqueEmployeesCount(dir);
                
                const tasks = dir.tasks && dir.tasks.length > 0 
                    ? (typeof dir.tasks[0] === 'string' 
                        ? dir.tasks.map(t => ({ name: t, assignedEmployees: [] })) 
                        : dir.tasks)
                    : [];
                
                let totalHours = 0;
                tasks.forEach(task => {
                    if (task.assignedEmployees) {
                        task.assignedEmployees.forEach(ae => {
                            const hours = typeof ae === 'object' ? (ae.hours || 0) : 0;
                            totalHours += hours;
                        });
                    }
                });
                
                return `
                <div class="card-container bg-white rounded-2xl shadow-lg overflow-hidden card-hover transition-all duration-300 relative">
                    <div class="bg-gradient-to-r ${dir.color} p-4 text-white">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-4xl">${dir.icon}</span>
                            <div class="flex items-center gap-2">
                                <span class="px-3 py-1 rounded-full text-xs font-medium border ${dir.priority === 'high' ? 'bg-red-500/40 text-red-200 border-black' : dir.priority === 'medium' ? 'bg-yellow-500/40 text-yellow-200 border-black' : 'bg-green-500/40 text-green-200 border-black'}">
                                    ${dir.priority === 'high' ? 'üî¥ –í—ã—Å–æ–∫–∏–π' : dir.priority === 'medium' ? 'üü° –°—Ä–µ–¥–Ω–∏–π' : 'üü¢ –ë–∞–∑–æ–≤—ã–π'}
                                </span>
                                <div class="btn-edit flex gap-1">
                                    <button onclick="openEditModal(${dir.id})" class="w-8 h-8 bg-white/20 hover:bg-white/40 rounded-full flex items-center justify-center backdrop-blur transition-all" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        ‚úèÔ∏è
                                    </button>
                                    <button onclick="openDeleteModal(${dir.id})" class="w-8 h-8 bg-white/20 hover:bg-red-500/80 rounded-full flex items-center justify-center backdrop-blur transition-all" title="–£–¥–∞–ª–∏—Ç—å">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold">${dir.title}</h3>
                    </div>
                    <div class="p-5">
                        <div class="mb-4">
                            <div class="flex justify-between text-sm text-gray-600 mb-1">
                                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                                <span class="font-semibold">${dir.progress}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r ${dir.color} h-2 rounded-full transition-all duration-500" style="width: ${dir.progress}%"></div>
                            </div>
                        </div>
                        <div class="space-y-3">
                            ${tasks.map(task => {
                                const taskEmps = (task.assignedEmployees || []).map(ae => {
                                    const id = typeof ae === 'object' ? ae.id : ae;
                                    const hours = typeof ae === 'object' ? ae.hours : 0;
                                    const isLead = typeof ae === 'object' ? (ae.isLead || false) : false;
                                    const emp = getEmployeeById(id);
                                    return emp ? { ...emp, hours, isLead } : null;
                                }).filter(e => e);
                                
                                return `
                                <div class="bg-gray-50 rounded-lg p-3 border border-gray-100">
                                    <div class="flex items-start gap-2 text-sm text-gray-700 font-medium mb-2">
                                        <span class="w-2 h-2 bg-purple-400 rounded-full mt-1.5 flex-shrink-0"></span>
                                        <span>${task.name}</span>
                                    </div>
                                    ${taskEmps.length > 0 ? `
                                    <div class="ml-4 space-y-1">
                                        ${taskEmps.map(emp => `
                                            <div class="flex items-center justify-between text-xs text-gray-500">
                                                <div class="flex items-center gap-2">
                                                    <span>${emp.isLead ? '‚≠ê' : 'üë§'}</span>
                                                    <span class="${emp.isLead ? 'font-bold text-gray-800' : ''}">${emp.lastName} ${emp.firstName} ${emp.middleName || ''}</span>
                                                </div>
                                                <span class="text-orange-500 font-medium">${emp.hours} —á/–Ω–µ–¥</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                    ` : `
                                    <div class="ml-4 text-xs text-gray-400 italic">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ</div>
                                    `}
                                </div>
                            `}).join('')}
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-2">
                                    <span class="text-gray-400">üë•</span>
                                    <span class="text-sm text-gray-600">${uniqueEmployeesCount} —á–µ–ª. ‚Ä¢ ${tasks.length} –∑–∞–¥–∞—á ‚Ä¢ ‚è±Ô∏è ${totalHours} —á/–Ω–µ–¥</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button onclick="openEditModal(${dir.id})" class="text-xs text-purple-600 hover:text-purple-800 transition-colors">
                                        ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å
                                    </button>
                                    <span class="w-3 h-3 bg-green-500 rounded-full pulse" title="–ê–∫—Ç–∏–≤–Ω–æ"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        // ============ EMPLOYEES FUNCTIONS ============

        function getStatusBadge(status, substituteId = null) {
            let badge = '';
            switch(status) {
                case 'active': badge = '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs">üü¢ –ê–∫—Ç–∏–≤–µ–Ω</span>'; break;
                case 'vacation': badge = '<span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs">üèñÔ∏è –û—Ç–ø—É—Å–∫</span>'; break;
                case 'sick': badge = '<span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs">üè• –ë–æ–ª—å–Ω–∏—á–Ω—ã–π</span>'; break;
                case 'remote': badge = '<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">üè† –£–¥–∞–ª—ë–Ω–Ω–æ</span>'; break;
                default: badge = '<span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs">‚Äî</span>';
            }
            
            if ((status === 'vacation' || status === 'sick') && substituteId) {
                const substitute = getEmployeeById(substituteId);
                if (substitute) {
                    badge += `<div class="mt-2 text-xs bg-orange-50 rounded-lg p-2 border border-orange-200">
                        <span class="font-bold text-orange-700">üîÑ –ó–∞–º–µ—â–∞–µ—Ç:</span><br>
                        <span class="text-orange-700 font-medium">${substitute.lastName} ${substitute.firstName} ${substitute.middleName || ''}</span>
                    </div>`;
                }
            }
            
            return badge;
        }

        function getRoleIcon(role) {
            switch(role) {
                case '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å': return 'üëî';
                case '–ê–Ω–∞–ª–∏—Ç–∏–∫': return 'üìä';
                case '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫': return 'üíª';
                case '–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫': return 'üß™';
                case '–ú–µ–Ω–µ–¥–∂–µ—Ä': return 'üìã';
                case '–î–∏–∑–∞–π–Ω–µ—Ä': return 'üé®';
                case 'DevOps': return '‚öôÔ∏è';
                default: return 'üìå';
            }
        }

        function renderEmployees(filter = '') {
            const grid = document.getElementById('employeesGrid');
            const noEmployees = document.getElementById('noEmployees');
            
            let filteredEmployees = employees;
            if (filter) {
                const searchLower = filter.toLowerCase();
                filteredEmployees = employees.filter(emp => 
                    emp.firstName.toLowerCase().includes(searchLower) ||
                    (emp.middleName && emp.middleName.toLowerCase().includes(searchLower)) ||
                    emp.lastName.toLowerCase().includes(searchLower) ||
                    emp.position.toLowerCase().includes(searchLower) ||
                    emp.role.toLowerCase().includes(searchLower)
                );
            }

            if (filteredEmployees.length === 0) {
                grid.innerHTML = '';
                noEmployees.classList.remove('hidden');
                return;
            }

            noEmployees.classList.add('hidden');
            grid.innerHTML = filteredEmployees.map((emp, index) => {
                const workload = calculateEmployeeWorkload(emp.id);
                const workloadPercent = Math.min((workload.totalHours / 40) * 100, 100);
                const isLeader = emp.role === '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å' || index === 0;
                
                return `
                <div class="employee-card ${isLeader ? 'bg-gradient-to-br from-purple-50 to-indigo-50 border-2 border-purple-300 ring-2 ring-purple-100' : 'bg-gray-50 border border-gray-100'} rounded-xl p-4 hover:shadow-md transition-all duration-300 group relative">
                    <div class="flex flex-col">
                        <div class="flex items-start justify-between mb-2">
                            <div>
                                <h4 class="${isLeader ? 'font-bold text-purple-800 text-lg' : 'font-semibold text-gray-800'} leading-tight">${emp.lastName} ${emp.firstName} ${emp.middleName || ''}</h4>
                                <p class="${isLeader ? 'text-sm text-indigo-600 font-semibold mt-1' : 'text-sm text-gray-600 mt-1'}">${emp.position}</p>
                            </div>
                            <div class="opacity-0 group-hover:opacity-100 transition-opacity flex gap-1 flex-shrink-0">
                                <button onclick="openEditEmployeeModal(${emp.id})" class="w-7 h-7 bg-blue-100 hover:bg-blue-200 rounded flex items-center justify-center text-sm" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                                <button onclick="openDeleteEmployeeModal(${emp.id})" class="w-7 h-7 bg-red-100 hover:bg-red-200 rounded flex items-center justify-center text-sm" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
                            <span>${getRoleIcon(emp.role)}</span>
                            <span>${emp.role}</span>
                        </div>
                        ${emp.phone ? `
                        <div class="flex items-center gap-2 text-xs text-gray-600 mb-1">
                            <span>üìû</span>
                            <span class="select-all cursor-text">${emp.phone}</span>
                        </div>
                        ` : ''}
                        ${emp.email ? `
                        <div class="flex items-center gap-2 text-xs text-gray-600 mb-1">
                            <span>üìß</span>
                            <span class="select-all cursor-text">${emp.email}</span>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-gray-600">‚è±Ô∏è –ó–∞–Ω—è—Ç–æ—Å—Ç—å –≤ –Ω–µ–¥–µ–ª—é</span>
                            <span class="text-sm font-bold ${workload.totalHours >= 40 ? 'text-red-600' : workload.totalHours >= 30 ? 'text-orange-600' : 'text-green-600'}">${workload.totalHours} —á</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                            <div class="${getWorkloadColor(workload.totalHours)} h-2 rounded-full transition-all duration-500" style="width: ${workloadPercent}%"></div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-500">${getWorkloadLabel(workload.totalHours)}</span>
                            <span class="text-xs text-gray-400">${workload.tasksList.length} –∑–∞–¥–∞—á</span>
                        </div>
                        ${workload.tasksList.length > 0 ? `
                        <details class="mt-2">
                            <summary class="text-xs text-purple-600 cursor-pointer hover:text-purple-800">–î–µ—Ç–∞–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∏</summary>
                            <div class="mt-2 space-y-1 max-h-32 overflow-y-auto">
                                ${workload.tasksList.map(t => `
                                    <div class="text-xs bg-white rounded p-2 border border-gray-100">
                                        <div class="font-medium text-gray-700">${t.task}</div>
                                        <div class="flex justify-between text-gray-500 mt-1">
                                            <span>${t.direction}</span>
                                            <span class="text-orange-500 font-medium">${t.hours} —á</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </details>
                        ` : ''}
                    </div>
                    
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        ${getStatusBadge(emp.status, emp.substituteId)}
                    </div>
                </div>
            `}).join('');
        }

        function filterEmployees() {
            const search = document.getElementById('employeeSearch').value;
            renderEmployees(search);
        }

        function toggleSubstituteField() {
            const status = document.getElementById('employeeStatus').value;
            const substituteField = document.getElementById('substituteField');
            const substituteSelect = document.getElementById('employeeSubstitute');
            
            if (status === 'vacation' || status === 'sick') {
                substituteField.classList.remove('hidden');
                const currentEmpId = document.getElementById('employeeEditId').value;
                const currentEmpIdInt = parseInt(currentEmpId);
                
                const currentEmployee = employees.find(e => e.id === currentEmpIdInt);
                const currentSubstituteId = currentEmployee ? currentEmployee.substituteId : null;
                
                const busySubstitutes = employees
                    .filter(emp => emp.substituteId && emp.id !== currentEmpIdInt)
                    .map(emp => emp.substituteId);
                
                substituteSelect.innerHTML = '<option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>' + 
                    employees
                        .filter(emp => {
                            if (emp.id === currentEmpIdInt) return false;
                            if (emp.status !== 'active') return false;
                            if (emp.id === currentSubstituteId) return true;
                            if (busySubstitutes.includes(emp.id)) return false;
                            return true;
                        })
                        .map(emp => `<option value="${emp.id}">${emp.lastName} ${emp.firstName} ${emp.middleName || ''} (${emp.position})</option>`)
                        .join('');
            } else {
                substituteField.classList.add('hidden');
                substituteSelect.value = '';
            }
        }

        function openEmployeeModal() {
            document.getElementById('employeeModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
            document.getElementById('employeeEditId').value = '';
            document.getElementById('employeeFirstName').value = '';
            document.getElementById('employeeMiddleName').value = '';
            document.getElementById('employeeLastName').value = '';
            document.getElementById('employeePosition').value = '';
            document.getElementById('employeeRole').value = '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫';
            document.getElementById('employeeEmail').value = '';
            document.getElementById('employeePhone').value = '';
            document.getElementById('employeeStatus').value = 'active';
            document.getElementById('employeeHireDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('employeeSubstitute').value = '';
            toggleSubstituteField();
            document.getElementById('employeeModal').classList.remove('hidden');
            document.getElementById('employeeModal').classList.add('flex');
        }

        function openEditEmployeeModal(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;
            
            document.getElementById('employeeModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
            document.getElementById('employeeEditId').value = id;
            document.getElementById('employeeFirstName').value = emp.firstName;
            document.getElementById('employeeMiddleName').value = emp.middleName || '';
            document.getElementById('employeeLastName').value = emp.lastName;
            document.getElementById('employeePosition').value = emp.position;
            document.getElementById('employeeRole').value = emp.role;
            document.getElementById('employeeEmail').value = emp.email || '';
            document.getElementById('employeePhone').value = emp.phone || '';
            document.getElementById('employeeStatus').value = emp.status;
            document.getElementById('employeeHireDate').value = emp.hireDate || '';
            toggleSubstituteField();
            setTimeout(() => {
                document.getElementById('employeeSubstitute').value = emp.substituteId || '';
            }, 0);
            document.getElementById('employeeModal').classList.remove('hidden');
            document.getElementById('employeeModal').classList.add('flex');
        }

        function closeEmployeeModal() {
            document.getElementById('employeeModal').classList.add('hidden');
            document.getElementById('employeeModal').classList.remove('flex');
        }

        function openDeleteEmployeeModal(id) {
            deleteEmployeeTargetId = id;
            document.getElementById('deleteEmployeeModal').classList.remove('hidden');
            document.getElementById('deleteEmployeeModal').classList.add('flex');
        }

        function closeDeleteEmployeeModal() {
            document.getElementById('deleteEmployeeModal').classList.add('hidden');
            document.getElementById('deleteEmployeeModal').classList.remove('flex');
            deleteEmployeeTargetId = null;
        }

        function confirmDeleteEmployee() {
            if (deleteEmployeeTargetId) {
                employees = employees.filter(e => e.id !== deleteEmployeeTargetId);
                saveEmployees();
                renderEmployees();
                closeDeleteEmployeeModal();
                showToast('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–¥–∞–ª—ë–Ω');
            }
        }

        // Employee form submission
        document.getElementById('employeeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const editId = document.getElementById('employeeEditId').value;
            const status = document.getElementById('employeeStatus').value;
            const substituteId = document.getElementById('employeeSubstitute').value;
            
            const empData = {
                firstName: document.getElementById('employeeFirstName').value,
                middleName: document.getElementById('employeeMiddleName').value,
                lastName: document.getElementById('employeeLastName').value,
                position: document.getElementById('employeePosition').value,
                role: document.getElementById('employeeRole').value,
                email: document.getElementById('employeeEmail').value,
                phone: document.getElementById('employeePhone').value,
                direction: '',
                status: status,
                hireDate: document.getElementById('employeeHireDate').value,
                substituteId: (status === 'vacation' || status === 'sick') && substituteId ? parseInt(substituteId) : null
            };
            
            if (editId) {
                const index = employees.findIndex(e => e.id === parseInt(editId));
                if (index !== -1) {
                    employees[index] = { ...employees[index], ...empData };
                }
                showToast('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ–±–Ω–æ–≤–ª—ë–Ω!');
            } else {
                const newId = employees.length > 0 ? Math.max(...employees.map(e => e.id)) + 1 : 1;
                employees.push({ id: newId, ...empData });
                showToast('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω!');
            }
            
            saveEmployees();
            renderEmployees();
            closeEmployeeModal();
        });

        // Set current date
        document.getElementById('updateDate').textContent = new Date().toLocaleDateString('ru-RU', {
            day: 'numeric',
            month: 'long',
            year: 'numeric'
        });

        // Close modals on outside click
        document.getElementById('directionModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        document.getElementById('deleteModal').addEventListener('click', function(e) {
            if (e.target === this) closeDeleteModal();
        });
        document.getElementById('employeeModal').addEventListener('click', function(e) {
            if (e.target === this) closeEmployeeModal();
        });
        document.getElementById('deleteEmployeeModal').addEventListener('click', function(e) {
            if (e.target === this) closeDeleteEmployeeModal();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closeDeleteModal();
                closeEmployeeModal();
                closeDeleteEmployeeModal();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                exportJSON();
            }
        });

        // Export data to JSON file
        function exportJSON() {
            var data = {
                directions: directions,
                employees: employees,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            var jsonString = JSON.stringify(data, null, 2);
            var blob = new Blob([jsonString], {type: 'application/json;charset=utf-8'});
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'taskboard_data_' + new Date().toISOString().slice(0,10) + '.json';
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            setTimeout(function() {
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
            }, 100);
            
            updateLastSaveTime();
            showToast('üì§ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
        }

        // Import data from JSON file
        function importJSON(input) {
            var file = input.files[0];
            if (!file) return;
            
            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var data = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (!data.directions || !data.employees) {
                        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                    }
                    
                    // Apply data
                    directions = data.directions;
                    employees = data.employees;
                    
                    // Save to localStorage
                    saveDirections();
                    saveEmployees();
                    
                    // Re-render
                    renderCards();
                    renderEmployees();
                    updateStats();
                    
                    showToast('üì• –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                } catch (err) {
                    showToast('‚ùå –û—à–∏–±–∫–∞: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset input so same file can be imported again
            input.value = '';
        }

        // Initialize
        renderCards();
        renderEmployees();
        updateStats();
        loadLastSaveTime();
    </script>
</body>
</html>
